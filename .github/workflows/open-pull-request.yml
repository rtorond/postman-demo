name: Deploy on App Engine pull request

on:
  push:
    branches-ignore:
      - master
  pull_request:
    branches-ignore:
      - master

jobs:
  build:
    runs-on: ubuntu-18.04
    steps:
    - uses: actions/checkout@v2
    - name: Slug environment variables
      uses: rlespinasse/github-slug-action@1.1.0
    - name: Deploy [carts-service] to App Engine
      uses: actions-hub/gcloud@268.0.0
      env:
        PROJECT_ID: postman-demo-269812
        APPLICATION_CREDENTIALS: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAicG9zdG1hbi1kZW1vLTI2OTgxMiIsCiAgInByaXZhdGVfa2V5X2lkIjogIjE1YjQ3Y2I4MDE0MzU1OTJhNGUxYjI2MTBiMGQ1ZmNkNGM4ZDcyNzkiLAogICJwcml2YXRlX2tleSI6ICItLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cbk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRRE9Nci92QloyaW11NFhcbkxJY1FoTXluVGFZMSt1S0RSWVE0SmdVWks4UVJsQVJMcnBoK1VPVnYwRG5DRHY0ME93eHBxbk5oMzBaQUp1ZVlcbkNoZkVLNDZZeDJKaklhMmRmWVBnbGhqbkpnblBkNk5MY3BsMTYrR1A3cUZUSU81UzhoQ00rQml5YXBoNURRajBcbmE5ZDhwQnlRWDRNRWx3Z1FQWG5WYitBZFNZZGF6WjZlWmdFRzNGdGZLeUlmWnQzK0hBWGdpM3ozRGtYUVdrLzhcbnA1b2FDN0M4S24zckl5cER3RnlCZStBN2xTTjAyYTdsdWxVMXppZFkvaEZWV1JrYTdEWFROaUZuZ1V6ZnJwM2RcbktPU0VOb09KYnk4TndyNVhQZWtOaWFNUWtXdUoxZVBNSC9Ud0l5eDBTMENNRG94VGc2eUFZNlNOamd4cis2NG1cbjR4cS95SDZ2QWdNQkFBRUNnZ0VBRGE0Nm8yK254L0xuNEJGbXZBR3JtR0FPVlRUYVBzNW54QzFBUWxnYWhVdGdcbjhPcUZHSlczeGZBMm5NNzZMbG4xUVY5N1BKK2YzV3JDQzk3WTQ5TGwva2RLNzZaN2lvcnZnSUR2a2JVcGluZk1cbkZabmxYNk1HVDFLTVVUa2Y4WHM0L2psZkNNWUtGcmRNTHZkUlpUdDROUVg1UHpQaFo1UEVsNzk1U3ZMUmNGbm5cbk9RTmhZbm1oN2FXejNaYzJJR0RhZ0Q5WGNWVzA5SFQ3aitkYmE1ZHRxYllFMDFUSmU2Ny9MQm8vRGVKdW00NUhcbkRqNzVXSXQ4Nk51SUQ2Z1JBZkc4WStLV290MWsxamRLaTFIT3hrS0RITkZMVENFVUJQRU1vdUZ2NTh1M3NJV0hcbjZiSXROY1hqbTE1bjdnRkhLSGtGczBOaWdMdk1CY3dhOFhNanRuMFhsUUtCZ1FEMG12aERXMVNjZnh4dDF4QmFcbnRqa1JVeDdjMnIzbDUva1JOYWRmRm1nKzc0UGs2NGQ0UFdxT3Y1S0ZWUkdTVDRGbmlFaWxnZ3lnKzF5cTB4MGZcbmpsTjBQZnRDZjk3c2JwVFN2dXZoREhpQ0lVMHhxMnJOc0oySnFTRXV0YlJpRU1MSmpkVUNZZ0dMS2xMVWNxSEJcbkNGQ21QdW13ck16NjRMVExjWkFzaEVic0xRS0JnUURYemNIMzJQRVpWeVVUZkliRW5nMUdMK0Z1elVqWjJVQ29cbkZTbW80M1pQdGxFRkpzMkJUcDJlM2YvNVAzYzBINXg2dG5qRC9sSlU0VmtXTEFoL2pJaUdzTXR5b3IrUktoNXlcbjZwQjBQVlNzMVIzYUY4WjlUWkxKbG9HMGZHZkVsYUJDbHN2OC9Tb2RlekNBekp3Y1NxRWUvSHF1eDl5V1pvK0JcbkIrSEt2aDl6eXdLQmdRRFFJQ2dMaitOdmdVeGNQWGpoNWxpcVlCSkxreWV2UG5FVGJwYXA5clBla1FlbHVhNDdcbjVlNEw1Zjh5eWM0NHNzT0ZwMVZBMW1ZT2Q3SkNlMzAxUTNISTM1QXg1Z0YxSlNZbUoyTW15dWlpdU5rbzRSVHdcblRVM09Pd1ZMN0RtK2swcGFHdjlhbHE5L2pSU0xSYnBTTjlQL2tGcGhCTGNvNUJlUlgyQndNR0QwUlFLQmdFVzFcbnIzeVNWWDlzQ1F2OFk4UkxrZG9rU1Z2emNCNys4TVhhNERRd0ZkMjE5UUlIQU1kT1Q5Z3J1aTRYZERnZ0pmbjFcbnk1ajBKRUJLOHU0WWx6NHNkVVdkQW5zclcxcFhFckxvVm5WV0FtNDZBWVNidllCb2VJd3AxQWdyVDVIUEM0KzNcbkNublVoYkEwUlB5Mkc0K0FBLy93YXVqZW9zRHFyRnh2NFY0T2dEWjFBb0dCQUtWSHloKzNmL2gzdVNPYlcrQWxcbldDVHV3Y1N3SU91VkRHdHpCdmR3dnNXUHdLOEk5QzZUYk9OSFErbEowZm1NY0RjbktLN0VLbXR4bTY1dlk0MC9cbk9Qa1JpOVlqazBsYjRQcWxNc1owM21FV0w0NXBydmRab015alViNVpIV1U5S3BuTG1OUWV5WmlwcGlMUDNoRVVcbklsb3ozQXVCenVISm4wZ0pYYlVscHI2UVxuLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLVxuIiwKICAiY2xpZW50X2VtYWlsIjogImFwcC1lbmdpbmVAcG9zdG1hbi1kZW1vLTI2OTgxMi5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsCiAgImNsaWVudF9pZCI6ICIxMDI0NDU5MDIwNjU5MjgzMzIwNTQiLAogICJhdXRoX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsCiAgInRva2VuX3VyaSI6ICJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlbiIsCiAgImF1dGhfcHJvdmlkZXJfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjEvY2VydHMiLAogICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L2FwcC1lbmdpbmUlNDBwb3N0bWFuLWRlbW8tMjY5ODEyLmlhbS5nc2VydmljZWFjY291bnQuY29tIgp9Cg==
      with:
        args: app deploy services/carts/app.yaml --no-promote --version=${{ env.GITHUB_REF_SLUG }}
    - name: Deploy [products-service] to App Engine
      uses: actions-hub/gcloud@268.0.0
      env:
        PROJECT_ID: postman-demo-269812
        APPLICATION_CREDENTIALS: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAicG9zdG1hbi1kZW1vLTI2OTgxMiIsCiAgInByaXZhdGVfa2V5X2lkIjogIjE1YjQ3Y2I4MDE0MzU1OTJhNGUxYjI2MTBiMGQ1ZmNkNGM4ZDcyNzkiLAogICJwcml2YXRlX2tleSI6ICItLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cbk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRRE9Nci92QloyaW11NFhcbkxJY1FoTXluVGFZMSt1S0RSWVE0SmdVWks4UVJsQVJMcnBoK1VPVnYwRG5DRHY0ME93eHBxbk5oMzBaQUp1ZVlcbkNoZkVLNDZZeDJKaklhMmRmWVBnbGhqbkpnblBkNk5MY3BsMTYrR1A3cUZUSU81UzhoQ00rQml5YXBoNURRajBcbmE5ZDhwQnlRWDRNRWx3Z1FQWG5WYitBZFNZZGF6WjZlWmdFRzNGdGZLeUlmWnQzK0hBWGdpM3ozRGtYUVdrLzhcbnA1b2FDN0M4S24zckl5cER3RnlCZStBN2xTTjAyYTdsdWxVMXppZFkvaEZWV1JrYTdEWFROaUZuZ1V6ZnJwM2RcbktPU0VOb09KYnk4TndyNVhQZWtOaWFNUWtXdUoxZVBNSC9Ud0l5eDBTMENNRG94VGc2eUFZNlNOamd4cis2NG1cbjR4cS95SDZ2QWdNQkFBRUNnZ0VBRGE0Nm8yK254L0xuNEJGbXZBR3JtR0FPVlRUYVBzNW54QzFBUWxnYWhVdGdcbjhPcUZHSlczeGZBMm5NNzZMbG4xUVY5N1BKK2YzV3JDQzk3WTQ5TGwva2RLNzZaN2lvcnZnSUR2a2JVcGluZk1cbkZabmxYNk1HVDFLTVVUa2Y4WHM0L2psZkNNWUtGcmRNTHZkUlpUdDROUVg1UHpQaFo1UEVsNzk1U3ZMUmNGbm5cbk9RTmhZbm1oN2FXejNaYzJJR0RhZ0Q5WGNWVzA5SFQ3aitkYmE1ZHRxYllFMDFUSmU2Ny9MQm8vRGVKdW00NUhcbkRqNzVXSXQ4Nk51SUQ2Z1JBZkc4WStLV290MWsxamRLaTFIT3hrS0RITkZMVENFVUJQRU1vdUZ2NTh1M3NJV0hcbjZiSXROY1hqbTE1bjdnRkhLSGtGczBOaWdMdk1CY3dhOFhNanRuMFhsUUtCZ1FEMG12aERXMVNjZnh4dDF4QmFcbnRqa1JVeDdjMnIzbDUva1JOYWRmRm1nKzc0UGs2NGQ0UFdxT3Y1S0ZWUkdTVDRGbmlFaWxnZ3lnKzF5cTB4MGZcbmpsTjBQZnRDZjk3c2JwVFN2dXZoREhpQ0lVMHhxMnJOc0oySnFTRXV0YlJpRU1MSmpkVUNZZ0dMS2xMVWNxSEJcbkNGQ21QdW13ck16NjRMVExjWkFzaEVic0xRS0JnUURYemNIMzJQRVpWeVVUZkliRW5nMUdMK0Z1elVqWjJVQ29cbkZTbW80M1pQdGxFRkpzMkJUcDJlM2YvNVAzYzBINXg2dG5qRC9sSlU0VmtXTEFoL2pJaUdzTXR5b3IrUktoNXlcbjZwQjBQVlNzMVIzYUY4WjlUWkxKbG9HMGZHZkVsYUJDbHN2OC9Tb2RlekNBekp3Y1NxRWUvSHF1eDl5V1pvK0JcbkIrSEt2aDl6eXdLQmdRRFFJQ2dMaitOdmdVeGNQWGpoNWxpcVlCSkxreWV2UG5FVGJwYXA5clBla1FlbHVhNDdcbjVlNEw1Zjh5eWM0NHNzT0ZwMVZBMW1ZT2Q3SkNlMzAxUTNISTM1QXg1Z0YxSlNZbUoyTW15dWlpdU5rbzRSVHdcblRVM09Pd1ZMN0RtK2swcGFHdjlhbHE5L2pSU0xSYnBTTjlQL2tGcGhCTGNvNUJlUlgyQndNR0QwUlFLQmdFVzFcbnIzeVNWWDlzQ1F2OFk4UkxrZG9rU1Z2emNCNys4TVhhNERRd0ZkMjE5UUlIQU1kT1Q5Z3J1aTRYZERnZ0pmbjFcbnk1ajBKRUJLOHU0WWx6NHNkVVdkQW5zclcxcFhFckxvVm5WV0FtNDZBWVNidllCb2VJd3AxQWdyVDVIUEM0KzNcbkNublVoYkEwUlB5Mkc0K0FBLy93YXVqZW9zRHFyRnh2NFY0T2dEWjFBb0dCQUtWSHloKzNmL2gzdVNPYlcrQWxcbldDVHV3Y1N3SU91VkRHdHpCdmR3dnNXUHdLOEk5QzZUYk9OSFErbEowZm1NY0RjbktLN0VLbXR4bTY1dlk0MC9cbk9Qa1JpOVlqazBsYjRQcWxNc1owM21FV0w0NXBydmRab015alViNVpIV1U5S3BuTG1OUWV5WmlwcGlMUDNoRVVcbklsb3ozQXVCenVISm4wZ0pYYlVscHI2UVxuLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLVxuIiwKICAiY2xpZW50X2VtYWlsIjogImFwcC1lbmdpbmVAcG9zdG1hbi1kZW1vLTI2OTgxMi5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsCiAgImNsaWVudF9pZCI6ICIxMDI0NDU5MDIwNjU5MjgzMzIwNTQiLAogICJhdXRoX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsCiAgInRva2VuX3VyaSI6ICJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlbiIsCiAgImF1dGhfcHJvdmlkZXJfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjEvY2VydHMiLAogICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L2FwcC1lbmdpbmUlNDBwb3N0bWFuLWRlbW8tMjY5ODEyLmlhbS5nc2VydmljZWFjY291bnQuY29tIgp9Cg==
      with:
        args: app deploy services/products/app.yaml --no-promote --version=${{ env.GITHUB_REF_SLUG }}
