name: Build and Deploy Feature Branch

on:
  push:
    branches-ignore:
      - master
  pull_request:
    branches-ignore:
      - master

jobs:
  build:
    runs-on: ubuntu-18.04
    steps:
    - uses: actions/checkout@v2
    - name: Slug environment variables
      uses: rlespinasse/github-slug-action@1.1.0
    - name: Deploy [carts-service] to App Engine
      uses: actions-hub/gcloud@268.0.0
      env:
        PROJECT_ID: postman-demo-269812
        APPLICATION_CREDENTIALS: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAicG9zdG1hbi1kZW1vLTI2OTgxMiIsCiAgInByaXZhdGVfa2V5X2lkIjogIjEyODQ3NmMxZDc0MmE2ZDkzMTQ0MjUzMTBjMWY4Y2EzMmMwYjlkNmMiLAogICJwcml2YXRlX2tleSI6ICItLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cbk1JSUV2QUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktZd2dnU2lBZ0VBQW9JQkFRRDRubXdFcnBvL3NCdlJcbk1qaUc4N0dTdGNLVTRJQTJ5UkNwckRmdGUzZk04T0w4K3BCa1RuT3dRdjhmVjcreC9HY0FWZ09iZkQ5aE1QZUhcbjkxRnRLRHVpQUNQdUNqNmVEcWh3TFlqeW1zWW5xQ2c1Wm9JVnA1ajVHUms4OThSMUlnaDM5a0JudHh1OHVCOEtcbkR1Z2xJc2x4MExoNWVwTHVmN0NhZ0s2YWowY2piZEhFNE4zOVdlUW00dkZlNEtoMVVFNE1OWHU4Ri9sVStSWkZcbmwvK0hzcGdrWEJYdStzL3ZJN3pXcDBaaWIxSTBhR05jSmY4MDBtUU45azhDenVwTmh2eVk4dHBXVzhMc3lqckRcblZWZ3EwakpkOENVUGtteXFKWjFSZ2NNdXZuSm5HNU5FTjQvdExHeTIyb2RDVU1IeVdJSSs1Mnc3Y01MNnR5K1NcbitGaFFlVmExQWdNQkFBRUNnZ0VBUE5Vb3FaR2VlUGhxcWdxUGhjZlJtb3dDVjBMQ1pJVllvQ2VkVEt6Q0VNR2RcblROaXpaWFBEdjJ4NU44NVUvNlE2Z0x6TEo2dWtaMi9mbFdPSXh6eUpzTmMzYzJxS3pVcFpZUTluTzdOdXltdk5cbklkUm8vb3J5ZFhyMGI3UlJXL2JPbXluRU13eDlDeldERk1jMmVzV3pCRGdWdDFXc1o1S1RZQTZlQ29BRjRFOG1cbmg3RE44YzFmc0ZCN1ltL0ZVNWpkUERROEhXVk5tRkFGSHNEcjFpMVErVE9QRUZHQVc3TzRmekdQSDZaKzZqQVdcblVQemN2WER0alJrV2lKSjBzS2ZYYTgwUytEMVM0TG5UZzllQU1zV3QxeXIyQktTcWdoRnB6MGtyYlprUU56VXNcblg5eW9wa3h2MWJLck8zdktYUSttQ3RhYzh3eUlwWTUvamJGYng0V2NJUUtCZ1FEOGFLMXJNdHN6eUxzOXgzSXNcbjgxWEtONmQzSXU0UFN3TUR0SEE1NEpyaXgzck9rWU45aTR0VjZndDBLZzJ1UExkQXVWV0lqNDZOdFA5aVlacW1cbkY3N3QvMzhYZmc1N1hCWUtWa3NXUHYwUkk0Y0Q0MkVJWXhaZkN5Njd5YWtpT1NJbGVzQjk0cGhWb2hGY1RaY01cbndKOVhsMkJlUFZWV1JuQzIrd2I1R21ubzFRS0JnUUQ4Si9DOVFrYzBmbG8zckhoWEdGOFoxSDNMQ1cwYnRNSDhcbmFZSGRocHBPWlljMU1SRjVmWXhPVHdJSEdVYnBRd1ArZk5EOGxOblpxT0k5amVoTzF5NHE2dmxmemlIRVUyQ3NcbkF0aFlLY1NqQ0ZkNllUQUZOZExFc2ZiU3orT0UraThQU1JwNEhTcmxJMzBvbzRHcjQ2OTdpNzQvS2dWeVZJYmlcbnFGRFFxdWFtWVFLQmdCMjlqOEZ6eXBROWNLS0UzNVVnVHRsMjJVcVdXUXFBUWlpcm1CV1p1MlpCTHQwc0ZCdzBcbjF3UVdnYWI4VllSVUx4dDNPdmJPUTNPN0FlUnJyN2NtVVI3bDNlbTh0cVFlWTVKd1BJU3dnMDBEcktMdXBiNUJcblBwK1FSNzlrc1lNUXpFOHlPWUFidE90U0gwMks3dU5YeHU2aExYK3RKbUwyQmMzcG9oYXo0QXJKQW9HQURwenBcbjhLM2tub0FzRGtucWQzR3NJVDBWUlN6NHE4QmY5WmJQdGR6VkdISDkwZkZVQit4a3N5MFUrd0JXQWJLbWlwc0ZcbktYNGUyZVJWcUNlUExQSi9kSEZGbm0yOXV6anh3MFl1NzMwTUxqNlBnMElhbkZLd01rSDJBZVdXVStDRDFhandcbjVjRWErVWlET2xXdmNCeXowTDhhZVdLZ0NpNG4ydjdTSUNXblZFRUNnWUJMY3NPeFZUNVVIcXJQSGg1V3ZNNnVcbkRjMEdnNS8zMzBtUzFvZk5SdC9pRnpsemIwNXRjK0NyZW1nWFJnR0hkcWdsSnJpL3l5MXNWa0JEV2FTK0U3b1dcblI0NU9IZDhRcnMybUlCdVQvTy9YZmVvY0tZOWhhanpld0lqQ1JHUzdyWWNmUDNzc0pEVU9HNlV4ZlVaK2FQYVZcbldIOTRuOHlZSHBkNHM1RU5YS09tZXc9PVxuLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLVxuIiwKICAiY2xpZW50X2VtYWlsIjogImFwcC1lbmdpbmUtZGVwbG95QHBvc3RtYW4tZGVtby0yNjk4MTIuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLAogICJjbGllbnRfaWQiOiAiMTE2MDg0NTE5MjQ3NDY3MTU5Mzg5IiwKICAiYXV0aF91cmkiOiAiaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tL28vb2F1dGgyL2F1dGgiLAogICJ0b2tlbl91cmkiOiAiaHR0cHM6Ly9vYXV0aDIuZ29vZ2xlYXBpcy5jb20vdG9rZW4iLAogICJhdXRoX3Byb3ZpZGVyX3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YxL2NlcnRzIiwKICAiY2xpZW50X3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vcm9ib3QvdjEvbWV0YWRhdGEveDUwOS9hcHAtZW5naW5lLWRlcGxveSU0MHBvc3RtYW4tZGVtby0yNjk4MTIuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iCn0K
      with:
        args: app deploy /services/carts/app.yaml --no-promote --version=${{ env.GITHUB_REF_SLUG }}
